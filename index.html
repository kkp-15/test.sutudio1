<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RiRi studio â€” ä½œæ¥­ç”¨BGM & ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­</title>
  <meta name="description" content="RiRi studio ã®ä½œæ¥­ç”¨BGMã¾ã¨ã‚ã€‚ã‚µãƒ ãƒã‚¯ãƒªãƒƒã‚¯ã§ãã®å ´å†ç”Ÿï¼†ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ãƒ»ã‚¿ã‚¤ãƒ ã§é›†ä¸­ã‚’ã‚µãƒãƒ¼ãƒˆã€‚">

  <!-- â˜… OGPï¼ˆå·®ã—æ›¿ãˆæ¨å¥¨ï¼‰ -->
  <meta property="og:title" content="RiRi studio â€” ä½œæ¥­ç”¨BGM & ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­" />
  <meta property="og:description" content="ç™’ã—ã®BGMã¨25åˆ†é›†ä¸­ï¼‹5åˆ†ä¼‘æ†©ã®ã‚¿ã‚¤ãƒãƒ¼ã§ã€ã‚‚ãã‚‚ãä½œæ¥­ã‚’ã‚µãƒãƒ¼ãƒˆï¼" />
  <meta property="og:image" content="https://example.com/ogp.png" />
  <meta property="og:url" content="https://example.com/" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- â˜… Faviconï¼ˆå·®ã—æ›¿ãˆæ¨å¥¨ï¼‰ -->
  <link rel="icon" href="favicon.ico" />

  <!-- ï¼ˆä»»æ„ï¼‰Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-2LM85GJN0L"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-2LM85GJN0L');
  </script>

  <style>
    :root{
      --bg:#fdfcfb; --panel:#ffffff; --ink:#222; --muted:#666;
      --accent:#ff6b9f; --accent2:#f4b86a;
      --radius:16px; --max:1200px; --shadow:0 6px 20px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Hiragino Sans","Noto Sans JP","Yu Gothic",Meiryo,Arial,sans-serif}

    /* Topbarï¼ˆãƒ­ã‚´ï¼‹SNSï¼‹æ“ä½œï¼‰ */
    .topbar{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.9);
      backdrop-filter:blur(6px);border-bottom:1px solid #eee}
    .top-inner{max-width:var(--max);margin:0 auto;padding:8px 12px;
      display:flex;align-items:center;gap:12px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900;color:var(--accent)}
    .brand img{height:34px;width:auto;display:block}
    .brand .fallback{font-size:1.1rem;letter-spacing:.02em}
    .top-spacer{flex:1}
    .sns-links{display:flex;gap:10px;align-items:center;margin-right:10px}
    .sns{
      display:inline-flex;align-items:center;justify-content:center;
      width:32px;height:32px;border-radius:50%;color:#fff;
      font-size:16px;text-decoration:none;font-weight:bold;
      transition:.2s; box-shadow:0 2px 5px rgba(0,0,0,.15);
    }
    .sns.youtube{background:#ff4444}
    .sns.youtube:hover{background:#cc0000}
    .sns.x{background:#000}
    .sns.x:hover{background:#444}
    .sns.insta{background:linear-gradient(45deg,#feda75,#d62976,#962fbf,#4f5bd5)}
    .sns.insta:hover{filter:brightness(1.1)}

    .top-actions{display:flex;gap:8px}
    .icon-btn{border:1px solid #ddd;background:#fff;border-radius:10px;padding:8px 10px;cursor:pointer}
    .icon-btn:hover{background:#f9f9f9}

    /* ãƒ’ãƒ¼ãƒ­ãƒ¼å¸¯ */
    header.hero{
      background:linear-gradient(135deg,#fbe0d8 0%,#ffd6e8 40%,#fff 100%);
      border-bottom:1px solid #eee;
    }
    .hero-inner{max-width:var(--max);margin:0 auto;padding:22px 12px;text-align:center}
    .hero-inner h1{margin:0;color:var(--accent);font-size:clamp(22px,4.8vw,34px)}
    .hero-inner p.lead{margin:6px 0 0;color:var(--muted)}

    /* ã‚°ãƒªãƒƒãƒ‰ï¼ˆBGMã‚«ãƒ¼ãƒ‰ï¼‰ */
    .grid{max-width:var(--max);margin:0 auto;padding:14px;display:grid;
      grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
    .card{background:var(--panel);border:1px solid #eee;border-radius:14px;overflow:hidden;box-shadow:var(--shadow)}
    .thumb{position:relative;aspect-ratio:16/9;cursor:pointer;background:#000}
    .thumb img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
    .play{position:absolute;bottom:8px;left:8px;background:rgba(255,255,255,.9);
      color:var(--accent);padding:4px 10px;border-radius:999px;font-weight:800;font-size:.8rem}
    .meta{padding:10px}
    .meta h3{margin:0;font-size:1rem;color:var(--accent)}

    .more-wrap{display:flex;justify-content:center;padding:16px}
    .more{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:0;
      padding:12px 18px;border-radius:999px;font-weight:800;cursor:pointer;box-shadow:var(--shadow)}
    .more:disabled{opacity:.5;cursor:not-allowed}

    /* ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ */
    section.pomodoro{max-width:var(--max);margin:20px auto 60px;padding:0 14px}
    .pom-card{
      border-radius:18px; overflow:hidden; box-shadow:var(--shadow);
      border:1px solid #e8e8e8;
    }
    .pom-head{
      padding:18px; text-align:center; border-bottom:1px solid #eee;
      background: linear-gradient(to right, #e0f7f6, #ffd6e8);
    }
    .pom-head h2{margin:0; font-size:1.4rem; color:#0d4b51}
    .pom-body{padding:16px; background:#fff; display:grid; gap:14px}
    .desc{
      max-width:780px; margin:0 auto; background:#ffffffcc; padding:12px 14px;
      border-radius:12px; font-size:.95rem; color:#0e3a3f;
    }
    .controls{display:flex; flex-wrap:wrap; gap:10px; justify-content:center}
    .controls button, .controls select{
      font-size:1rem; padding:.6rem 1rem; border:none; border-radius:1rem; cursor:pointer;
      background-color:#b2dfdb; color:#004d40; transition:background-color .2s;
    }
    .controls button:hover, .controls select:hover{ background-color:#80cbc4 }
    .timer-area{ text-align:center }
    #timer{ font-size:3rem; margin:.2rem 0 }
    #message{ font-size:1.05rem; font-weight:bold; min-height:1.5em; color:#0e3a3f }

    iframe#bgmPlayer{
      width:100%; max-width:720px; height:405px; display:block;
      margin:12px auto 0; border:none; border-radius:14px;
    }

    /* ãƒ•ãƒƒã‚¿ãƒ¼ï¼ˆRiRiã®SNSã®ã¿ï¼‰ */
    .footer-links{margin:40px auto; display:flex; gap:10px; justify-content:center; flex-wrap:wrap}
    .footer-links a{
      display:inline-block; padding:.5rem 1rem; border-radius:1rem; text-decoration:none;
      box-shadow:0 2px 6px rgba(0,0,0,.2); color:#fff; transition:.2s;
    }
    .footer-links a:hover{ transform:scale(1.05) }
    .youtube-btn{ background:#ff4444 }
    .x-btn{ background:#000 }
    .insta-btn{ background:#e1306c }

    /* è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« */
    dialog.settings{border:none;border-radius:12px;box-shadow:var(--shadow);padding:0;max-width:520px;width:92%}
    .set-head{padding:12px 14px;border-bottom:1px solid #eee;font-weight:800}
    .set-body{padding:14px;display:grid;gap:12px}
    .set-row{display:grid;gap:6px}
    .set-actions{display:flex;justify-content:flex-end;gap:8px;padding:12px;border-top:1px solid #eee}
    .text{padding:.6rem .8rem;border:1px solid #ddd;border-radius:10px}
    .switch{display:inline-flex;align-items:center;gap:8px;cursor:pointer}
    .switch input{transform:scale(1.2)}

    /* èƒŒæ™¯ï¼ˆä½œæ¥­/ä¼‘æ†©ï¼‰ */
    body.work { background: linear-gradient(to bottom, #fdfcfb, #fff) }
    body.break { background: linear-gradient(to bottom, #f0f7ff, #fff) }
  </style>
</head>

<body class="work">
  <!-- Topbar with Logo + SNS + Controls -->
  <div class="topbar">
    <div class="top-inner">
      <div class="brand">
        <!-- ãƒ­ã‚´ï¼š/logo.png ã‚’ç½®ãã‹ã€è¨­å®šã§URLæŒ‡å®šå¯ã€‚èª­ã‚ãªã‘ã‚Œã°ãƒ†ã‚­ã‚¹ãƒˆãƒ­ã‚´è¡¨ç¤º -->
        <img id="logoImg" src="logo.png" alt="RiRi studio" onerror="this.style.display='none'">
        <span class="fallback" id="logoText">RiRi studio</span>
      </div>

      <div class="top-spacer"></div>

      <!-- SNS -->
      <div class="sns-links">
        <a href="https://youtube.com/@riri8bgm" target="_blank" class="sns youtube" title="YouTube">â–¶</a>
        <a href="https://x.com/riri8bgm" target="_blank" class="sns x" title="X">ğ•</a>
        <a href="https://instagram.com/riri8bgm" target="_blank" class="sns insta" title="Instagram">ğŸ“·</a>
      </div>

      <!-- Controls -->
      <div class="top-actions">
        <button class="icon-btn" id="notifyBtn" title="é€šçŸ¥ON/OFF">ğŸ””</button>
        <button class="icon-btn" id="settingsBtn" title="è¨­å®š">âš™</button>
      </div>
    </div>
  </div>

  <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼å¸¯ -->
  <header class="hero">
    <div class="hero-inner">
      <h1>ğŸš RiRi studio ä½œæ¥­ç”¨BGM</h1>
      <p class="lead">ã‚µãƒ ãƒã‚’ã‚¯ãƒªãƒƒã‚¯ã§ãã®å ´å†ç”Ÿã€‚ä¸‹ã®ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã§ã€25åˆ†é›†ä¸­ï¼‹5åˆ†ä¼‘æ†©ã‚’ãƒ«ãƒ¼ãƒ—ï¼</p>
    </div>
  </header>

  <!-- BGM ã‚°ãƒªãƒƒãƒ‰ -->
  <section aria-label="BGMä¸€è¦§">
    <div class="grid" id="videoGrid"></div>
    <div class="more-wrap">
      <button class="more" id="moreBtn">ã‚‚ã£ã¨è¦‹ã‚‹</button>
    </div>
  </section>

  <!-- ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ -->
  <section class="pomodoro" aria-label="ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ãƒ»ã‚¿ã‚¤ãƒ ">
    <div class="pom-card">
      <div class="pom-head">
        <h2>RIRI ğŸŒº ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ãƒ»ã‚¿ã‚¤ãƒ  ğŸŒ´</h2>
      </div>
      <div class="pom-body">
        <div class="desc">
          <strong>ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ãƒ»ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¨ã¯ï¼Ÿ</strong><br>
          25åˆ†é›†ä¸­ï¼‹5åˆ†ä¼‘æ†©ã‚’1ã‚»ãƒƒãƒˆã¨ã—ã¦ç¹°ã‚Šè¿”ã™ã€ã‚·ãƒ³ãƒ—ãƒ«ã§åŠ¹æœçš„ãªæ™‚é–“ç®¡ç†æ³•ã§ã™ã€‚<br>
          é›†ä¸­ã‚¿ã‚¤ãƒãƒ¼ã¨ç™’ã—ã®BGMã§ã€Œã‚‚ãã‚‚ãä½œæ¥­ã€ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ğŸº
        </div>

        <div class="controls">
          <label for="musicSelect">ğŸ¶ æ›²ã‚’é¸ã¶ï¼š</label>
          <select id="musicSelect"></select>

          <button onclick="setMode(25,5)">â±ï¸ 25åˆ†/5åˆ†</button>
          <button onclick="setMode(50,10)">â±ï¸ 50åˆ†/10åˆ†</button>
          <button id="muteBtn" title="ãƒŸãƒ¥ãƒ¼ãƒˆåˆ‡æ›¿">ğŸ”‡ ãƒŸãƒ¥ãƒ¼ãƒˆ</button>
        </div>

        <div class="timer-area">
          <div id="timer">25:00</div>
          <div id="message"></div>
          <div class="controls">
            <button id="startBtn" onclick="startLoop()">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            <button id="pauseBtn">â¸ ä¸€æ™‚åœæ­¢</button>
            <button onclick="resetLoop()">âŸ² ãƒªã‚»ãƒƒãƒˆ</button>
          </div>
        </div>

        <iframe id="bgmPlayer" allow="autoplay"></iframe>

        <!-- RiRi studio SNSãƒªãƒ³ã‚¯ -->
        <div class="footer-links">
          <a class="youtube-btn" href="https://youtube.com/@riri8bgm" target="_blank" rel="noopener">YouTube</a>
          <a class="x-btn" href="https://x.com/riri8bgm" target="_blank" rel="noopener">X</a>
          <a class="insta-btn" href="https://instagram.com/riri8bgm" target="_blank" rel="noopener">Instagram</a>
        </div>
      </div>
    </div>
  </section>

  <!-- è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <dialog class="settings" id="settingsDlg">
    <div class="set-head">âš™ è¨­å®š</div>
    <div class="set-body">
      <div class="set-row">
        <label>ãƒ­ã‚´ç”»åƒURLï¼ˆä¾‹ï¼š/logo.png ã¾ãŸã¯ https://â€¦ï¼‰</label>
        <input class="text" id="logoUrlInput" placeholder="ç©ºãªã‚‰ /logo.png ã‚’è©¦ã—ã¾ã™">
      </div>
      <div class="set-row">
        <label class="switch">
          <input type="checkbox" id="notifyToggle">
          <span>ãƒ•ã‚§ãƒ¼ã‚ºåˆ‡æ›¿æ™‚ã«ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—é€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹</span>
        </label>
      </div>
      <div class="set-row">
        <label class="switch">
          <input type="checkbox" id="autoMuteToggle">
          <span>YouTubeåŸ‹ã‚è¾¼ã¿ã‚’å¸¸ã«ãƒŸãƒ¥ãƒ¼ãƒˆå†ç”Ÿï¼ˆè‡ªå‹•å†ç”Ÿå¯¾ç­–ï¼‰</span>
        </label>
      </div>
    </div>
    <div class="set-actions">
      <button class="icon-btn" id="closeSettings">é–‰ã˜ã‚‹</button>
      <button class="icon-btn" id="saveSettings">ä¿å­˜</button>
    </div>
  </dialog>

  <script>
    /* ====== BGM ãƒ‡ãƒ¼ã‚¿ ====== */
    const videos = [
      {id:"xvcXZbvYf0s", title:"Morning Glow â€” æœæ—¥ã«æº¶ã‘ã‚‹ãƒ”ã‚¢ãƒ"},
      {id:"W0lUBVcvJiw", title:"Ocean Breeze â€” æµ·é¢¨ã®Lo-fi"},
      {id:"nlzxWWjB-ik", title:"Night Vibes â€” å¤œã‚’å½©ã‚‹Chill Beat"},
      {id:"Fdp4u_SUjKE", title:"City Lights â€” éƒ½ä¼šã®ç¯ã‚Šã¨éŸ³"},
      {id:"o-wCYm_Pm6A", title:"Rainy Cafe â€” é›¨éŸ³ã‚«ãƒ•ã‚§BGM"},
      {id:"HoljfuP1POQ", title:"Sunset Chill â€” å¤•æš®ã‚Œã®ãƒãƒ«ã‚¢ã‚¦ãƒˆ"},
      {id:"rWyX16RTMgk", title:"Midnight Flow â€” æ·±å¤œã®é›†ä¸­ã‚µã‚¦ãƒ³ãƒ‰"},
      {id:"lY3x33Q9p7Y", title:"Soft Waves â€” æ³¢éŸ³ã«ç™’ã•ã‚Œã¦"},
      {id:"zoKoxAws_qg", title:"Dreamscape â€” å¤¢å¹»ã®æ—‹å¾‹"},
      {id:"Y5mkp8pRuug", title:"Study Energy â€” å‹‰å¼·ãŒã¯ã‹ã©ã‚‹BGM"},
      {id:"BYra5__dZt8", title:"Starry Night â€” æ˜Ÿç©ºã®ä¸‹ã§"},
      {id:"HmYecNjo-YU", title:"Forest Echo â€” æ£®ã®ã•ã•ã‚„ã"},
      {id:"QLDlN5QeFJY", title:"Coffee Break â€” ã‚«ãƒ•ã‚§æ°—åˆ†ã§ä½œæ¥­"},
      {id:"_ES-qbX3PZw", title:"Chill Horizon â€” ç©ã‚„ã‹ãªåœ°å¹³ç·š"},
      {id:"gum_BK-TaNc", title:"Gentle Wind â€” ãã‚ˆé¢¨ã®èª¿ã¹"},
      {id:"aR2wgXX1LKw", title:"Piano Healing â€” ç™’ã—ã®ãƒ”ã‚¢ãƒ"},
      {id:"8YhHNFx6IG4", title:"Focus Beats â€” é›†ä¸­ã™ã‚‹Lo-fi"},
      {id:"fdvMXXki5aI", title:"Morning Rain â€” é›¨ä¸ŠãŒã‚Šã®æœ"},
      {id:"_daHDiMOhUg", title:"Calm Mind â€” å¿ƒè½ã¡ç€ãéŸ³"},
      {id:"JHgbgOtCh6o", title:"Ocean Sunset â€” æµ·ã«æ²ˆã‚€å¤•æ—¥"},
      {id:"EuEzwLm1rVg", title:"Energy Flow â€” ä½œæ¥­åŠ¹ç‡UPã‚µã‚¦ãƒ³ãƒ‰"},
      {id:"sO3IO8ITQbk", title:"Relax Vibes â€” ã»ã£ã¨ä¸€æ¯Lo-fi"},
      {id:"7Col7jbU58I", title:"Moonlight â€” æœˆæ˜ã‹ã‚Šã®æ—‹å¾‹"},
      {id:"HoljfuP1POQ", title:"Evening Glow â€” ã‚†ã£ãŸã‚Šå¤•æš®ã‚Œ"},
      {id:"jwls6XgOqeI", title:"Warm Memories â€” ã‚ãŸãŸã‹ãªæ€ã„å‡º"},
      {id:"pvB3cN41kLg", title:"Chill Traveler â€” æ—…ã™ã‚‹æ°—åˆ†ã®BGM"},
      {id:"-0BGU5JNgx4", title:"Pure Relax â€” ç©ã‚„ã‹ãªä¼‘æ¯"},
      {id:"tn8xWxJlTHk", title:"Breeze Flow â€” é¢¨ã«æºã‚Œã‚‹æ—‹å¾‹"},
      {id:"IUtaYi5tc7Q", title:"Focus Piano â€” ãƒ”ã‚¢ãƒã§é›†ä¸­"},
      {id:"ftyC1THMVPU", title:"Night Cafe â€” å¤œã®ã‚«ãƒ•ã‚§ã§ä½œæ¥­"},
      {id:"1CaYmGW0JRk", title:"Morning Drive â€” çˆ½å¿«ãªæœãƒ‰ãƒ©ã‚¤ãƒ–"},
      {id:"PX9qcl3O4ko", title:"Chill Stream â€” æ°´éŸ³ã¨ç™’ã—"},
      {id:"txOSbA_gdAM", title:"Deep Focus â€” æ·±ãé›†ä¸­ã™ã‚‹æ™‚é–“"},
      {id:"ireQV7GrQzk", title:"Healing Guitar â€” ç™’ã—ã®ã‚¢ã‚³ãƒ¼ã‚¹ãƒ†ã‚£ãƒƒã‚¯"},
      {id:"KbY08F0C8Wg", title:"Sunrise Glow â€” æœæ—¥ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼"}
    ];

    /* ====== è¨­å®šãƒ»ä¿å­˜ã‚­ãƒ¼ ====== */
    const LS = {
      LOGO: 'riri_logo_url',
      NOTIFY: 'riri_notify',
      AUTO_MUTE: 'riri_auto_mute',
      LAST_VIDEO: 'riri_last_video',
      LAST_MODE: 'riri_last_mode' // "25-5" | "50-10"
    };

    /* ====== BGM ã‚°ãƒªãƒƒãƒ‰ï¼ˆ12ä»¶ãšã¤è¡¨ç¤ºï¼‰ ====== */
    const CHUNK = 12;
    let shown = 0;
    const grid = document.getElementById("videoGrid");
    const moreBtn = document.getElementById("moreBtn");

    function renderChunk(){
      const slice = videos.slice(shown, shown + CHUNK);
      slice.forEach(v=>{
        const card=document.createElement("article");
        card.className="card";
        card.innerHTML = `
          <div class="thumb" data-yt="${v.id}">
            <img src="https://img.youtube.com/vi/${v.id}/hqdefault.jpg" alt="${v.title}">
            <span class="play">â–¶ å†ç”Ÿ</span>
          </div>
          <div class="meta"><h3>${v.title}</h3></div>
        `;
        grid.appendChild(card);
      });
      shown += slice.length;
      updateMore();
    }
    function updateMore(){
      const remain = Math.max(0, videos.length - shown);
      if(remain === 0){
        moreBtn.textContent = "ã™ã¹ã¦è¡¨ç¤ºã—ã¾ã—ãŸ";
        moreBtn.disabled = true;
      } else {
        moreBtn.textContent = `ã‚‚ã£ã¨è¦‹ã‚‹ï¼ˆæ®‹ã‚Š ${remain}ï¼‰`;
      }
    }
    grid.addEventListener("click", e=>{
      const box = e.target.closest(".thumb");
      if(!box) return;
      const id = box.dataset.yt;
      const wrap = document.createElement("div");
      wrap.style.position="relative"; wrap.style.aspectRatio="16/9";
      const mute = getAutoMute() ? 1 : 0;
      wrap.innerHTML = `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1&mute=${mute}&loop=1&playlist=${id}"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen style="position:absolute;inset:0;width:100%;height:100%;border:0;border-radius:14px;"></iframe>`;
      box.replaceWith(wrap);
    });
    moreBtn.addEventListener("click", renderChunk);
    renderChunk(); // åˆæœŸæç”»

    /* ====== ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ ====== */
    const selectEl = document.getElementById("musicSelect");
    // ã‚»ãƒ¬ã‚¯ãƒˆã¸å‹•ç”»ã‚’æµã—è¾¼ã¿
    videos.forEach(v=>{
      const opt = document.createElement("option");
      opt.value = v.id; opt.textContent = v.title;
      selectEl.appendChild(opt);
    });

    let timer;
    let time = 1500;           // 25 * 60
    let running = false;
    let paused = false;
    let isWork = true;
    let workDuration = 1500;   // ç§’
    let breakDuration = 300;   // ç§’
    let nextVideoId = null;    // ä¼‘æ†©ä¸­ã«é¸ã‚“ã æ›²ã‚’æ¬¡ã®ä½œæ¥­ã§åæ˜ 

    const timerEl = document.getElementById("timer");
    const msgEl = document.getElementById("message");
    const iframe = document.getElementById("bgmPlayer");
    const pauseBtn = document.getElementById("pauseBtn");
    const muteBtn = document.getElementById("muteBtn");

    function fmt(t){ const m=Math.floor(t/60), s=t%60; return `${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;}
    function updateDisplay(){ timerEl.textContent = fmt(time); }

    function getAutoMute(){ return localStorage.getItem(LS.AUTO_MUTE) === '1'; }
    function getNotify(){ return localStorage.getItem(LS.NOTIFY) === '1'; }
    function notify(title, body){
      if(!getNotify()) return;
      if(Notification.permission === 'granted'){
        new Notification(title, { body });
      }
    }

    // é¸æ›²ã§å³åˆ‡æ›¿ã€‚ä¼‘æ†©ä¸­ã¯äºˆç´„ã—ã¦æ¬¡ã®ä½œæ¥­é–‹å§‹ã§åæ˜ 
    function updateBGM(force = false){
      const videoId = selectEl.value;
      localStorage.setItem(LS.LAST_VIDEO, videoId);
      const mute = getAutoMute() ? 1 : 0;
      if (running && !isWork && !force) {
        nextVideoId = videoId;
        msgEl.textContent = "ğŸµ æ›²ã‚’å¤‰æ›´ã—ã¾ã—ãŸã€‚æ¬¡ã®ä½œæ¥­ã‚¿ã‚¤ãƒ ã§å†ç”Ÿã—ã¾ã™ã€‚";
        return;
      }
      iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=${mute}&loop=1&playlist=${videoId}`;
    }

    function startLoop(){
      if (running) return;
      running = true; paused = false; isWork = true;
      startPhase();
    }

    function setMode(workMin, breakMin){
      if (running) return;
      workDuration = workMin * 60;
      breakDuration = breakMin * 60;
      time = workDuration;
      localStorage.setItem(LS.LAST_MODE, `${workMin}-${breakMin}`);
      updateDisplay();
    }

    function startPhase(){
      clearInterval(timer);
      document.body.className = isWork ? "work" : "break";
      time = isWork ? workDuration : breakDuration;
      updateDisplay();

      // ä¼‘æ†©â†’ä½œæ¥­é–‹å§‹æ™‚ã«äºˆç´„æ›²ã‚’åæ˜ 
      if (isWork && nextVideoId) {
        selectEl.value = nextVideoId;
        nextVideoId = null;
      }

      msgEl.textContent = isWork
        ? `ğŸŒº é›†ä¸­ã‚¿ã‚¤ãƒ é–‹å§‹ï¼æ¬¡ã¯${breakDuration/60}åˆ†ã®ä¼‘æ†©ã§ã™ ğŸï¸`
        : `ğŸ–ï¸ ä¼‘æ†©ã‚¹ã‚¿ãƒ¼ãƒˆï¼æ¬¡ã¯${workDuration/60}åˆ†ã®ä½œæ¥­ã‚¿ã‚¤ãƒ ã§ã™ ğŸŒŠ`;

      notify(isWork ? "é›†ä¸­ã‚¿ã‚¤ãƒ é–‹å§‹" : "ä¼‘æ†©ã‚¹ã‚¿ãƒ¼ãƒˆ",
             isWork ? `æ¬¡ã¯${breakDuration/60}åˆ†ã®ä¼‘æ†©` : `æ¬¡ã¯${workDuration/60}åˆ†ã®ä½œæ¥­`);

      updateBGM(); // ç¾åœ¨é¸æŠã®æ›²ã‚’åæ˜ 

      timer = setInterval(()=>{
        if (paused) return;
        if (time > 0){
          time--; updateDisplay();
        } else {
          isWork = !isWork;
          if (!isWork) iframe.src = ""; // ä¼‘æ†©å…¥ã‚Šã§åœæ­¢
          startPhase();
        }
      }, 1000);
    }

    function resetLoop(){
      clearInterval(timer);
      time = workDuration;
      running = false;
      paused = false;
      isWork = true;
      updateDisplay();
      iframe.src = "";
      document.body.className = "work";
      msgEl.textContent = "";
      pauseBtn.textContent = "â¸ ä¸€æ™‚åœæ­¢";
    }

    function togglePause(){
      if (!running) return;
      paused = !paused;
      pauseBtn.textContent = paused ? "â–¶ å†é–‹" : "â¸ ä¸€æ™‚åœæ­¢";
    }

    function toggleMute(){
      const now = getAutoMute();
      localStorage.setItem(LS.AUTO_MUTE, now ? '0' : '1');
      muteBtn.textContent = now ? "ğŸ”‡ ãƒŸãƒ¥ãƒ¼ãƒˆ" : "ğŸ”Š ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤";
      // å†èª­è¾¼ã—ã¦åæ˜ ï¼ˆåŸ‹ã‚è¾¼ã¿URLã®muteãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å…¥ã‚Œæ›¿ãˆã‚‹ï¼‰
      if (iframe.src) updateBGM(true);
    }

    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ï¼šã‚¹ãƒšãƒ¼ã‚¹ã§ä¸€æ™‚åœæ­¢/å†é–‹
    window.addEventListener('keydown', e=>{
      if (e.code === 'Space'){ e.preventDefault(); togglePause(); }
    });

    // ã‚»ãƒ¬ã‚¯ãƒˆå¤‰æ›´â†’å³åæ˜ ï¼ˆæœªã‚¹ã‚¿ãƒ¼ãƒˆã§ã‚‚OKï¼‰
    selectEl.addEventListener("change", () => updateBGM(true));
    pauseBtn.addEventListener("click", togglePause);
    muteBtn.addEventListener("click", toggleMute);

    /* ====== Topbarï¼šé€šçŸ¥/è¨­å®š/ãƒ­ã‚´ ====== */
    const notifyBtn   = document.getElementById('notifyBtn');
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsDlg = document.getElementById('settingsDlg');
    const logoImg     = document.getElementById('logoImg');
    const logoText    = document.getElementById('logoText');
    const logoUrlInput= document.getElementById('logoUrlInput');
    const notifyToggle= document.getElementById('notifyToggle');
    const autoMuteToggle = document.getElementById('autoMuteToggle');
    const saveSettings= document.getElementById('saveSettings');
    const closeSettings= document.getElementById('closeSettings');

    function applyLogo(url){
      if (url){
        logoImg.style.display='block';
        logoImg.src = url;
        logoImg.onerror = () => { logoImg.style.display='none'; };
      }else{
        // è©¦ã—ã« /logo.png
        logoImg.style.display='block';
        logoImg.src = 'logo.png';
        logoImg.onerror = () => { logoImg.style.display='none'; };
      }
    }

    function refreshNotifyIcon(){
      notifyBtn.textContent = getNotify() ? 'ğŸ””' : 'ğŸ”•';
    }

    notifyBtn.addEventListener('click', async ()=>{
      const wantOn = !getNotify();
      if (wantOn){
        if (Notification.permission === 'granted'){
          localStorage.setItem(LS.NOTIFY, '1');
        } else {
          const perm = await Notification.requestPermission();
          localStorage.setItem(LS.NOTIFY, perm === 'granted' ? '1' : '0');
        }
      } else {
        localStorage.setItem(LS.NOTIFY, '0');
      }
      refreshNotifyIcon();
    });

    settingsBtn.addEventListener('click', ()=>{
      logoUrlInput.value = localStorage.getItem(LS.LOGO) || '';
      notifyToggle.checked = getNotify();
      autoMuteToggle.checked = getAutoMute();
      settingsDlg.showModal();
    });
    closeSettings.addEventListener('click', ()=> settingsDlg.close());
    saveSettings.addEventListener('click', ()=>{
      const url = logoUrlInput.value.trim();
      if (url) localStorage.setItem(LS.LOGO, url); else localStorage.removeItem(LS.LOGO);
      localStorage.setItem(LS.NOTIFY, notifyToggle.checked ? '1' : '0');
      localStorage.setItem(LS.AUTO_MUTE, autoMuteToggle.checked ? '1' : '0');
      applyLogo(localStorage.getItem(LS.LOGO) || '');
      refreshNotifyIcon();
      muteBtn.textContent = getAutoMute() ? "ğŸ”Š ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤" : "ğŸ”‡ ãƒŸãƒ¥ãƒ¼ãƒˆ";
      settingsDlg.close();
    });

    /* ====== åˆæœŸå¾©å…ƒ ====== */
    (function init(){
      // ãƒ­ã‚´
      applyLogo(localStorage.getItem(LS.LOGO) || '');

      // é€šçŸ¥ã‚¢ã‚¤ã‚³ãƒ³ãƒ»ãƒŸãƒ¥ãƒ¼ãƒˆãƒœã‚¿ãƒ³è¡¨è¨˜
      refreshNotifyIcon();
      muteBtn.textContent = getAutoMute() ? "ğŸ”Š ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤" : "ğŸ”‡ ãƒŸãƒ¥ãƒ¼ãƒˆ";

      // å‰å›ãƒ¢ãƒ¼ãƒ‰
      const lastMode = localStorage.getItem(LS.LAST_MODE);
      if (lastMode === '50-10'){ setMode(50,10); } else { setMode(25,5); } // setModeã¯æœªç¨¼åƒæ™‚ã®ã¿æœ‰åŠ¹

      // å‰å›é¸æ›²
      const lastVideo = localStorage.getItem(LS.LAST_VIDEO);
      if (lastVideo && videos.some(v=>v.id===lastVideo)){
        selectEl.value = lastVideo;
      } else {
        selectEl.value = videos[0].id;
      }

      updateDisplay();
      // åˆæœŸã¯å†ç”Ÿã—ãªã„ï¼ˆè‡ªå‹•å†ç”Ÿåˆ¶é™å›é¿ï¼‰ã€‚å¿…è¦ãªã‚‰ä¸‹è¡Œã‚’æœ‰åŠ¹åŒ–
      // updateBGM(true);
    })();
  </script>
</body>
</html>
