<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RiRi studio — 作業用BGM & ポモドーロ</title>
  <meta name="description" content="RiRi studio の作業用BGMまとめ。サムネクリックでその場再生＆ポモドーロ・タイムで集中をサポート。">

  <!-- ★ OGP（差し替え推奨） -->
  <meta property="og:title" content="RiRi studio — 作業用BGM & ポモドーロ" />
  <meta property="og:description" content="癒しのBGMと25分集中＋5分休憩のタイマーで、もくもく作業をサポート！" />
  <meta property="og:image" content="https://example.com/ogp.png" />
  <meta property="og:url" content="https://example.com/" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- ★ Favicon（差し替え推奨） -->
  <link rel="icon" href="favicon.ico" />

  <!-- （任意）Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-2LM85GJN0L"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-2LM85GJN0L');
  </script>

  <style>
    :root{
      --bg:#fdfcfb; --panel:#ffffff; --ink:#222; --muted:#666;
      --accent:#ff6b9f; --accent2:#f4b86a;
      --radius:16px; --max:1200px; --shadow:0 6px 20px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Hiragino Sans","Noto Sans JP","Yu Gothic",Meiryo,Arial,sans-serif}

    /* Topbar（ロゴ＋SNS＋操作） */
    .topbar{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.9);
      backdrop-filter:blur(6px);border-bottom:1px solid #eee}
    .top-inner{max-width:var(--max);margin:0 auto;padding:8px 12px;
      display:flex;align-items:center;gap:12px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900;color:var(--accent)}
    .brand img{height:34px;width:auto;display:block}
    .brand .fallback{font-size:1.1rem;letter-spacing:.02em}
    .top-spacer{flex:1}
    .sns-links{display:flex;gap:10px;align-items:center;margin-right:10px}
    .sns{
      display:inline-flex;align-items:center;justify-content:center;
      width:32px;height:32px;border-radius:50%;color:#fff;
      font-size:16px;text-decoration:none;font-weight:bold;
      transition:.2s; box-shadow:0 2px 5px rgba(0,0,0,.15);
    }
    .sns.youtube{background:#ff4444}
    .sns.youtube:hover{background:#cc0000}
    .sns.x{background:#000}
    .sns.x:hover{background:#444}
    .sns.insta{background:linear-gradient(45deg,#feda75,#d62976,#962fbf,#4f5bd5)}
    .sns.insta:hover{filter:brightness(1.1)}

    .top-actions{display:flex;gap:8px}
    .icon-btn{border:1px solid #ddd;background:#fff;border-radius:10px;padding:8px 10px;cursor:pointer}
    .icon-btn:hover{background:#f9f9f9}

    /* ヒーロー帯 */
    header.hero{
      background:linear-gradient(135deg,#fbe0d8 0%,#ffd6e8 40%,#fff 100%);
      border-bottom:1px solid #eee;
    }
    .hero-inner{max-width:var(--max);margin:0 auto;padding:22px 12px;text-align:center}
    .hero-inner h1{margin:0;color:var(--accent);font-size:clamp(22px,4.8vw,34px)}
    .hero-inner p.lead{margin:6px 0 0;color:var(--muted)}

    /* グリッド（BGMカード） */
    .grid{max-width:var(--max);margin:0 auto;padding:14px;display:grid;
      grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
    .card{background:var(--panel);border:1px solid #eee;border-radius:14px;overflow:hidden;box-shadow:var(--shadow)}
    .thumb{position:relative;aspect-ratio:16/9;cursor:pointer;background:#000}
    .thumb img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
    .play{position:absolute;bottom:8px;left:8px;background:rgba(255,255,255,.9);
      color:var(--accent);padding:4px 10px;border-radius:999px;font-weight:800;font-size:.8rem}
    .meta{padding:10px}
    .meta h3{margin:0;font-size:1rem;color:var(--accent)}

    .more-wrap{display:flex;justify-content:center;padding:16px}
    .more{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:0;
      padding:12px 18px;border-radius:999px;font-weight:800;cursor:pointer;box-shadow:var(--shadow)}
    .more:disabled{opacity:.5;cursor:not-allowed}

    /* ポモドーロ */
    section.pomodoro{max-width:var(--max);margin:20px auto 60px;padding:0 14px}
    .pom-card{
      border-radius:18px; overflow:hidden; box-shadow:var(--shadow);
      border:1px solid #e8e8e8;
    }
    .pom-head{
      padding:18px; text-align:center; border-bottom:1px solid #eee;
      background: linear-gradient(to right, #e0f7f6, #ffd6e8);
    }
    .pom-head h2{margin:0; font-size:1.4rem; color:#0d4b51}
    .pom-body{padding:16px; background:#fff; display:grid; gap:14px}
    .desc{
      max-width:780px; margin:0 auto; background:#ffffffcc; padding:12px 14px;
      border-radius:12px; font-size:.95rem; color:#0e3a3f;
    }
    .controls{display:flex; flex-wrap:wrap; gap:10px; justify-content:center}
    .controls button, .controls select{
      font-size:1rem; padding:.6rem 1rem; border:none; border-radius:1rem; cursor:pointer;
      background-color:#b2dfdb; color:#004d40; transition:background-color .2s;
    }
    .controls button:hover, .controls select:hover{ background-color:#80cbc4 }
    .timer-area{ text-align:center }
    #timer{ font-size:3rem; margin:.2rem 0 }
    #message{ font-size:1.05rem; font-weight:bold; min-height:1.5em; color:#0e3a3f }

    iframe#bgmPlayer{
      width:100%; max-width:720px; height:405px; display:block;
      margin:12px auto 0; border:none; border-radius:14px;
    }

    /* フッター（RiRiのSNSのみ） */
    .footer-links{margin:40px auto; display:flex; gap:10px; justify-content:center; flex-wrap:wrap}
    .footer-links a{
      display:inline-block; padding:.5rem 1rem; border-radius:1rem; text-decoration:none;
      box-shadow:0 2px 6px rgba(0,0,0,.2); color:#fff; transition:.2s;
    }
    .footer-links a:hover{ transform:scale(1.05) }
    .youtube-btn{ background:#ff4444 }
    .x-btn{ background:#000 }
    .insta-btn{ background:#e1306c }

    /* 設定モーダル */
    dialog.settings{border:none;border-radius:12px;box-shadow:var(--shadow);padding:0;max-width:520px;width:92%}
    .set-head{padding:12px 14px;border-bottom:1px solid #eee;font-weight:800}
    .set-body{padding:14px;display:grid;gap:12px}
    .set-row{display:grid;gap:6px}
    .set-actions{display:flex;justify-content:flex-end;gap:8px;padding:12px;border-top:1px solid #eee}
    .text{padding:.6rem .8rem;border:1px solid #ddd;border-radius:10px}
    .switch{display:inline-flex;align-items:center;gap:8px;cursor:pointer}
    .switch input{transform:scale(1.2)}

    /* 背景（作業/休憩） */
    body.work { background: linear-gradient(to bottom, #fdfcfb, #fff) }
    body.break { background: linear-gradient(to bottom, #f0f7ff, #fff) }
  </style>
</head>

<body class="work">
  <!-- Topbar with Logo + SNS + Controls -->
  <div class="topbar">
    <div class="top-inner">
      <div class="brand">
        <!-- ロゴ：/logo.png を置くか、設定でURL指定可。読めなければテキストロゴ表示 -->
        <img id="logoImg" src="logo.png" alt="RiRi studio" onerror="this.style.display='none'">
        <span class="fallback" id="logoText">RiRi studio</span>
      </div>

      <div class="top-spacer"></div>

      <!-- SNS -->
      <div class="sns-links">
        <a href="https://youtube.com/@riri8bgm" target="_blank" class="sns youtube" title="YouTube">▶</a>
        <a href="https://x.com/riri8bgm" target="_blank" class="sns x" title="X">𝕏</a>
        <a href="https://instagram.com/riri8bgm" target="_blank" class="sns insta" title="Instagram">📷</a>
      </div>

      <!-- Controls -->
      <div class="top-actions">
        <button class="icon-btn" id="notifyBtn" title="通知ON/OFF">🔔</button>
        <button class="icon-btn" id="settingsBtn" title="設定">⚙</button>
      </div>
    </div>
  </div>

  <!-- ヒーロー帯 -->
  <header class="hero">
    <div class="hero-inner">
      <h1>🐚 RiRi studio 作業用BGM</h1>
      <p class="lead">サムネをクリックでその場再生。下のポモドーロで、25分集中＋5分休憩をループ！</p>
    </div>
  </header>

  <!-- BGM グリッド -->
  <section aria-label="BGM一覧">
    <div class="grid" id="videoGrid"></div>
    <div class="more-wrap">
      <button class="more" id="moreBtn">もっと見る</button>
    </div>
  </section>

  <!-- ポモドーロ -->
  <section class="pomodoro" aria-label="ポモドーロ・タイム">
    <div class="pom-card">
      <div class="pom-head">
        <h2>RIRI 🌺 ポモドーロ・タイム 🌴</h2>
      </div>
      <div class="pom-body">
        <div class="desc">
          <strong>ポモドーロ・テクニックとは？</strong><br>
          25分集中＋5分休憩を1セットとして繰り返す、シンプルで効果的な時間管理法です。<br>
          集中タイマーと癒しのBGMで「もくもく作業」をサポートします🎺
        </div>

        <div class="controls">
          <label for="musicSelect">🎶 曲を選ぶ：</label>
          <select id="musicSelect"></select>

          <button onclick="setMode(25,5)">⏱️ 25分/5分</button>
          <button onclick="setMode(50,10)">⏱️ 50分/10分</button>
          <button id="muteBtn" title="ミュート切替">🔇 ミュート</button>
        </div>

        <div class="timer-area">
          <div id="timer">25:00</div>
          <div id="message"></div>
          <div class="controls">
            <button id="startBtn" onclick="startLoop()">▶ スタート</button>
            <button id="pauseBtn">⏸ 一時停止</button>
            <button onclick="resetLoop()">⟲ リセット</button>
          </div>
        </div>

        <iframe id="bgmPlayer" allow="autoplay"></iframe>

        <!-- RiRi studio SNSリンク -->
        <div class="footer-links">
          <a class="youtube-btn" href="https://youtube.com/@riri8bgm" target="_blank" rel="noopener">YouTube</a>
          <a class="x-btn" href="https://x.com/riri8bgm" target="_blank" rel="noopener">X</a>
          <a class="insta-btn" href="https://instagram.com/riri8bgm" target="_blank" rel="noopener">Instagram</a>
        </div>
      </div>
    </div>
  </section>

  <!-- 設定モーダル -->
  <dialog class="settings" id="settingsDlg">
    <div class="set-head">⚙ 設定</div>
    <div class="set-body">
      <div class="set-row">
        <label>ロゴ画像URL（例：/logo.png または https://…）</label>
        <input class="text" id="logoUrlInput" placeholder="空なら /logo.png を試します">
      </div>
      <div class="set-row">
        <label class="switch">
          <input type="checkbox" id="notifyToggle">
          <span>フェーズ切替時にデスクトップ通知を表示する</span>
        </label>
      </div>
      <div class="set-row">
        <label class="switch">
          <input type="checkbox" id="autoMuteToggle">
          <span>YouTube埋め込みを常にミュート再生（自動再生対策）</span>
        </label>
      </div>
    </div>
    <div class="set-actions">
      <button class="icon-btn" id="closeSettings">閉じる</button>
      <button class="icon-btn" id="saveSettings">保存</button>
    </div>
  </dialog>

  <script>
    /* ====== BGM データ ====== */
    const videos = [
      {id:"xvcXZbvYf0s", title:"Morning Glow — 朝日に溶けるピアノ"},
      {id:"W0lUBVcvJiw", title:"Ocean Breeze — 海風のLo-fi"},
      {id:"nlzxWWjB-ik", title:"Night Vibes — 夜を彩るChill Beat"},
      {id:"Fdp4u_SUjKE", title:"City Lights — 都会の灯りと音"},
      {id:"o-wCYm_Pm6A", title:"Rainy Cafe — 雨音カフェBGM"},
      {id:"HoljfuP1POQ", title:"Sunset Chill — 夕暮れのチルアウト"},
      {id:"rWyX16RTMgk", title:"Midnight Flow — 深夜の集中サウンド"},
      {id:"lY3x33Q9p7Y", title:"Soft Waves — 波音に癒されて"},
      {id:"zoKoxAws_qg", title:"Dreamscape — 夢幻の旋律"},
      {id:"Y5mkp8pRuug", title:"Study Energy — 勉強がはかどるBGM"},
      {id:"BYra5__dZt8", title:"Starry Night — 星空の下で"},
      {id:"HmYecNjo-YU", title:"Forest Echo — 森のささやき"},
      {id:"QLDlN5QeFJY", title:"Coffee Break — カフェ気分で作業"},
      {id:"_ES-qbX3PZw", title:"Chill Horizon — 穏やかな地平線"},
      {id:"gum_BK-TaNc", title:"Gentle Wind — そよ風の調べ"},
      {id:"aR2wgXX1LKw", title:"Piano Healing — 癒しのピアノ"},
      {id:"8YhHNFx6IG4", title:"Focus Beats — 集中するLo-fi"},
      {id:"fdvMXXki5aI", title:"Morning Rain — 雨上がりの朝"},
      {id:"_daHDiMOhUg", title:"Calm Mind — 心落ち着く音"},
      {id:"JHgbgOtCh6o", title:"Ocean Sunset — 海に沈む夕日"},
      {id:"EuEzwLm1rVg", title:"Energy Flow — 作業効率UPサウンド"},
      {id:"sO3IO8ITQbk", title:"Relax Vibes — ほっと一息Lo-fi"},
      {id:"7Col7jbU58I", title:"Moonlight — 月明かりの旋律"},
      {id:"HoljfuP1POQ", title:"Evening Glow — ゆったり夕暮れ"},
      {id:"jwls6XgOqeI", title:"Warm Memories — あたたかな思い出"},
      {id:"pvB3cN41kLg", title:"Chill Traveler — 旅する気分のBGM"},
      {id:"-0BGU5JNgx4", title:"Pure Relax — 穏やかな休息"},
      {id:"tn8xWxJlTHk", title:"Breeze Flow — 風に揺れる旋律"},
      {id:"IUtaYi5tc7Q", title:"Focus Piano — ピアノで集中"},
      {id:"ftyC1THMVPU", title:"Night Cafe — 夜のカフェで作業"},
      {id:"1CaYmGW0JRk", title:"Morning Drive — 爽快な朝ドライブ"},
      {id:"PX9qcl3O4ko", title:"Chill Stream — 水音と癒し"},
      {id:"txOSbA_gdAM", title:"Deep Focus — 深く集中する時間"},
      {id:"ireQV7GrQzk", title:"Healing Guitar — 癒しのアコースティック"},
      {id:"KbY08F0C8Wg", title:"Sunrise Glow — 朝日のエネルギー"}
    ];

    /* ====== 設定・保存キー ====== */
    const LS = {
      LOGO: 'riri_logo_url',
      NOTIFY: 'riri_notify',
      AUTO_MUTE: 'riri_auto_mute',
      LAST_VIDEO: 'riri_last_video',
      LAST_MODE: 'riri_last_mode' // "25-5" | "50-10"
    };

    /* ====== BGM グリッド（12件ずつ表示） ====== */
    const CHUNK = 12;
    let shown = 0;
    const grid = document.getElementById("videoGrid");
    const moreBtn = document.getElementById("moreBtn");

    function renderChunk(){
      const slice = videos.slice(shown, shown + CHUNK);
      slice.forEach(v=>{
        const card=document.createElement("article");
        card.className="card";
        card.innerHTML = `
          <div class="thumb" data-yt="${v.id}">
            <img src="https://img.youtube.com/vi/${v.id}/hqdefault.jpg" alt="${v.title}">
            <span class="play">▶ 再生</span>
          </div>
          <div class="meta"><h3>${v.title}</h3></div>
        `;
        grid.appendChild(card);
      });
      shown += slice.length;
      updateMore();
    }
    function updateMore(){
      const remain = Math.max(0, videos.length - shown);
      if(remain === 0){
        moreBtn.textContent = "すべて表示しました";
        moreBtn.disabled = true;
      } else {
        moreBtn.textContent = `もっと見る（残り ${remain}）`;
      }
    }
    grid.addEventListener("click", e=>{
      const box = e.target.closest(".thumb");
      if(!box) return;
      const id = box.dataset.yt;
      const wrap = document.createElement("div");
      wrap.style.position="relative"; wrap.style.aspectRatio="16/9";
      const mute = getAutoMute() ? 1 : 0;
      wrap.innerHTML = `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1&mute=${mute}&loop=1&playlist=${id}"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen style="position:absolute;inset:0;width:100%;height:100%;border:0;border-radius:14px;"></iframe>`;
      box.replaceWith(wrap);
    });
    moreBtn.addEventListener("click", renderChunk);
    renderChunk(); // 初期描画

    /* ====== ポモドーロ ====== */
    const selectEl = document.getElementById("musicSelect");
    // セレクトへ動画を流し込み
    videos.forEach(v=>{
      const opt = document.createElement("option");
      opt.value = v.id; opt.textContent = v.title;
      selectEl.appendChild(opt);
    });

    let timer;
    let time = 1500;           // 25 * 60
    let running = false;
    let paused = false;
    let isWork = true;
    let workDuration = 1500;   // 秒
    let breakDuration = 300;   // 秒
    let nextVideoId = null;    // 休憩中に選んだ曲を次の作業で反映

    const timerEl = document.getElementById("timer");
    const msgEl = document.getElementById("message");
    const iframe = document.getElementById("bgmPlayer");
    const pauseBtn = document.getElementById("pauseBtn");
    const muteBtn = document.getElementById("muteBtn");

    function fmt(t){ const m=Math.floor(t/60), s=t%60; return `${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;}
    function updateDisplay(){ timerEl.textContent = fmt(time); }

    function getAutoMute(){ return localStorage.getItem(LS.AUTO_MUTE) === '1'; }
    function getNotify(){ return localStorage.getItem(LS.NOTIFY) === '1'; }
    function notify(title, body){
      if(!getNotify()) return;
      if(Notification.permission === 'granted'){
        new Notification(title, { body });
      }
    }

    // 選曲で即切替。休憩中は予約して次の作業開始で反映
    function updateBGM(force = false){
      const videoId = selectEl.value;
      localStorage.setItem(LS.LAST_VIDEO, videoId);
      const mute = getAutoMute() ? 1 : 0;
      if (running && !isWork && !force) {
        nextVideoId = videoId;
        msgEl.textContent = "🎵 曲を変更しました。次の作業タイムで再生します。";
        return;
      }
      iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=${mute}&loop=1&playlist=${videoId}`;
    }

    function startLoop(){
      if (running) return;
      running = true; paused = false; isWork = true;
      startPhase();
    }

    function setMode(workMin, breakMin){
      if (running) return;
      workDuration = workMin * 60;
      breakDuration = breakMin * 60;
      time = workDuration;
      localStorage.setItem(LS.LAST_MODE, `${workMin}-${breakMin}`);
      updateDisplay();
    }

    function startPhase(){
      clearInterval(timer);
      document.body.className = isWork ? "work" : "break";
      time = isWork ? workDuration : breakDuration;
      updateDisplay();

      // 休憩→作業開始時に予約曲を反映
      if (isWork && nextVideoId) {
        selectEl.value = nextVideoId;
        nextVideoId = null;
      }

      msgEl.textContent = isWork
        ? `🌺 集中タイム開始！次は${breakDuration/60}分の休憩です 🏝️`
        : `🏖️ 休憩スタート！次は${workDuration/60}分の作業タイムです 🌊`;

      notify(isWork ? "集中タイム開始" : "休憩スタート",
             isWork ? `次は${breakDuration/60}分の休憩` : `次は${workDuration/60}分の作業`);

      updateBGM(); // 現在選択の曲を反映

      timer = setInterval(()=>{
        if (paused) return;
        if (time > 0){
          time--; updateDisplay();
        } else {
          isWork = !isWork;
          if (!isWork) iframe.src = ""; // 休憩入りで停止
          startPhase();
        }
      }, 1000);
    }

    function resetLoop(){
      clearInterval(timer);
      time = workDuration;
      running = false;
      paused = false;
      isWork = true;
      updateDisplay();
      iframe.src = "";
      document.body.className = "work";
      msgEl.textContent = "";
      pauseBtn.textContent = "⏸ 一時停止";
    }

    function togglePause(){
      if (!running) return;
      paused = !paused;
      pauseBtn.textContent = paused ? "▶ 再開" : "⏸ 一時停止";
    }

    function toggleMute(){
      const now = getAutoMute();
      localStorage.setItem(LS.AUTO_MUTE, now ? '0' : '1');
      muteBtn.textContent = now ? "🔇 ミュート" : "🔊 ミュート解除";
      // 再読込して反映（埋め込みURLのmuteパラメータを入れ替える）
      if (iframe.src) updateBGM(true);
    }

    // キーボード：スペースで一時停止/再開
    window.addEventListener('keydown', e=>{
      if (e.code === 'Space'){ e.preventDefault(); togglePause(); }
    });

    // セレクト変更→即反映（未スタートでもOK）
    selectEl.addEventListener("change", () => updateBGM(true));
    pauseBtn.addEventListener("click", togglePause);
    muteBtn.addEventListener("click", toggleMute);

    /* ====== Topbar：通知/設定/ロゴ ====== */
    const notifyBtn   = document.getElementById('notifyBtn');
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsDlg = document.getElementById('settingsDlg');
    const logoImg     = document.getElementById('logoImg');
    const logoText    = document.getElementById('logoText');
    const logoUrlInput= document.getElementById('logoUrlInput');
    const notifyToggle= document.getElementById('notifyToggle');
    const autoMuteToggle = document.getElementById('autoMuteToggle');
    const saveSettings= document.getElementById('saveSettings');
    const closeSettings= document.getElementById('closeSettings');

    function applyLogo(url){
      if (url){
        logoImg.style.display='block';
        logoImg.src = url;
        logoImg.onerror = () => { logoImg.style.display='none'; };
      }else{
        // 試しに /logo.png
        logoImg.style.display='block';
        logoImg.src = 'logo.png';
        logoImg.onerror = () => { logoImg.style.display='none'; };
      }
    }

    function refreshNotifyIcon(){
      notifyBtn.textContent = getNotify() ? '🔔' : '🔕';
    }

    notifyBtn.addEventListener('click', async ()=>{
      const wantOn = !getNotify();
      if (wantOn){
        if (Notification.permission === 'granted'){
          localStorage.setItem(LS.NOTIFY, '1');
        } else {
          const perm = await Notification.requestPermission();
          localStorage.setItem(LS.NOTIFY, perm === 'granted' ? '1' : '0');
        }
      } else {
        localStorage.setItem(LS.NOTIFY, '0');
      }
      refreshNotifyIcon();
    });

    settingsBtn.addEventListener('click', ()=>{
      logoUrlInput.value = localStorage.getItem(LS.LOGO) || '';
      notifyToggle.checked = getNotify();
      autoMuteToggle.checked = getAutoMute();
      settingsDlg.showModal();
    });
    closeSettings.addEventListener('click', ()=> settingsDlg.close());
    saveSettings.addEventListener('click', ()=>{
      const url = logoUrlInput.value.trim();
      if (url) localStorage.setItem(LS.LOGO, url); else localStorage.removeItem(LS.LOGO);
      localStorage.setItem(LS.NOTIFY, notifyToggle.checked ? '1' : '0');
      localStorage.setItem(LS.AUTO_MUTE, autoMuteToggle.checked ? '1' : '0');
      applyLogo(localStorage.getItem(LS.LOGO) || '');
      refreshNotifyIcon();
      muteBtn.textContent = getAutoMute() ? "🔊 ミュート解除" : "🔇 ミュート";
      settingsDlg.close();
    });

    /* ====== 初期復元 ====== */
    (function init(){
      // ロゴ
      applyLogo(localStorage.getItem(LS.LOGO) || '');

      // 通知アイコン・ミュートボタン表記
      refreshNotifyIcon();
      muteBtn.textContent = getAutoMute() ? "🔊 ミュート解除" : "🔇 ミュート";

      // 前回モード
      const lastMode = localStorage.getItem(LS.LAST_MODE);
      if (lastMode === '50-10'){ setMode(50,10); } else { setMode(25,5); } // setModeは未稼働時のみ有効

      // 前回選曲
      const lastVideo = localStorage.getItem(LS.LAST_VIDEO);
      if (lastVideo && videos.some(v=>v.id===lastVideo)){
        selectEl.value = lastVideo;
      } else {
        selectEl.value = videos[0].id;
      }

      updateDisplay();
      // 初期は再生しない（自動再生制限回避）。必要なら下行を有効化
      // updateBGM(true);
    })();
  </script>
</body>
</html>
